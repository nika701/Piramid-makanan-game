<!doctype html>
<html lang="ms">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>SUSUN MAKANAN DALAM PIRAMID MAKANAN ‚Äî v13</title>
  <style>
    :root { --ink:#000; --card:#fff; --grid:#d1fae5; --safe-b: env(safe-area-inset-bottom, 0px); }
    *{box-sizing:border-box} html,body{height:100%;margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,Noto Sans,sans-serif;color:#111827}
    body{background-image:linear-gradient(var(--grid) 2px,transparent 2px),linear-gradient(90deg,var(--grid) 2px,transparent 2px);background-size:20px 20px}
    .wrap{max-width:1200px;margin:0 auto;padding:16px}
    .grid{display:grid;grid-template-columns:1fr;gap:16px}
    @media (min-width:900px){.grid{grid-template-columns:340px 1fr;gap:24px}}
    .card{background:var(--card);border:4px solid var(--ink);border-radius:16px;box-shadow:6px 6px 0 0 var(--ink)}
    .pad{padding:14px} @media (min-width:768px){.pad{padding:18px}}
    .btn{background:#fde047;border:4px solid var(--ink);border-radius:12px;padding:10px 14px;font-weight:800;box-shadow:4px 4px 0 0 var(--ink);cursor:pointer}
    .btn:active{transform:translate(2px,2px);box-shadow:2px 2px 0 0 var(--ink)}
    .btn.secondary{background:#e5e7eb}
    .title{font-weight:900;font-size:22px} @media (min-width:768px){.title{font-size:28px}}
    .small{font-size:13px} .xs{font-size:12px}
    .row{display:flex;justify-content:center;margin-top:10px}
    .w-top{width:80%;max-width:420px} .w-midA{width:90%;max-width:560px} .w-midB{width:95%;max-width:720px} .w-bottom{width:100%}
    @media (min-width:900px){.w-top{width:33%;max-width:380px}.w-midA{width:50%;max-width:520px}.w-midB{width:66%;max-width:680px}}
    .drop{min-height:120px;border:4px solid var(--ink);border-radius:16px;padding:10px;box-shadow:6px 6px 0 0 var(--ink);background:#e5e7eb;transition:filter .15s,transform .15s}
    @media (max-width:899px){.drop{min-height:140px}}
    .drop .hdr{display:flex;align-items:center;justify-content:space-between;font-weight:900;font-size:13px;text-transform:uppercase}
    .drop .grid{display:grid;grid-template-columns:repeat(6,minmax(0,1fr));gap:4px;margin-top:6px}
    .drop .cell{text-align:center} .drop .cell .emoji{font-size:28px}
    .hint{font-size:12px;opacity:.7;font-style:italic;grid-column:1/-1}
    .dim{filter:grayscale(1) contrast(.7) opacity(.6)} .pulse{animation:pulse 1s infinite}
    @keyframes pulse{0%{transform:scale(1)}50%{transform:scale(1.02)}100%{transform:scale(1)}}
    #palette-left{display:none} @media (min-width:900px){#palette-left{display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:8px}}
    .food{text-align:center;user-select:none;cursor:grab}
    .food .box{border:4px solid var(--ink);border-radius:16px;padding:8px;background:#fff;box-shadow:6px 6px 0 0 var(--ink)}
    .food .emoji{font-size:30px;line-height:1} .food .name{font-size:12px;font-weight:700;margin-top:4px}
    .sprite{width:32px;height:32px;object-fit:contain} .food .sprite{width:34px;height:34px} .chip .sprite{width:36px;height:36px}
    .dock{position:fixed;left:0;right:0;bottom:0;background:#fff;border-top:4px solid var(--ink);box-shadow:0 -6px 0 0 var(--ink);padding:8px 8px calc(8px + var(--safe-b));z-index:30}
    .dock-row{display:flex;align-items:center;gap:8px} .dock-title{font-weight:900}
    .dock-strip{display:flex;overflow-x:auto;-webkit-overflow-scrolling:touch;gap:10px;scroll-snap-type:x mandatory;padding:8px 2px}
    .chip{flex:0 0 auto;width:88px;height:88px;border:4px solid var(--ink);border-radius:14px;display:flex;flex-direction:column;align-items:center;justify-content:center;box-shadow:4px 4px 0 0 var(--ink);scroll-snap-align:start;background:#fff}
    .chip .emoji{font-size:32px} .chip .name{font-size:12px;font-weight:800;margin-top:4px;text-align:center}
    .chip.held{opacity:.6}
    .overlay{position:fixed;inset:0;background:linear-gradient(#e5e7eb 2px,transparent 2px),linear-gradient(90deg,#e5e7eb 2px,transparent 2px);background-size:20px 20px;display:flex;align-items:center;justify-content:center;padding:16px;z-index:40}
    .start{max-width:820px;width:100%} .center{text-align:center} .mb-2{margin-bottom:8px} .mb-3{margin-bottom:12px} .mt-6{margin-top:24px}
    .logo-top img{height:auto;max-height:112px;max-width:320px;object-fit:contain} @media (min-width:1024px){.logo-top img{max-height:128px}}
    .start-content{max-width:640px;margin:0 auto}
    .logo-bar img{width:100%;height:auto;max-height:80px;object-fit:contain}
    .overlay-end{position:fixed;inset:0;background:rgba(0,0,0,.35);display:none;align-items:center;justify-content:center;padding:16px;z-index:50}
    .panel{max-width:760px;width:100%} .big{font-size:26px;font-weight:900;letter-spacing:.5px}
    .form{display:grid;gap:10px;margin-top:10px} .row-actions{display:flex;gap:8px;flex-wrap:wrap}
    .input{border:4px solid var(--ink);border-radius:12px;padding:10px 12px;font-weight:700;width:100%}
    .two{display:grid;grid-template-columns:1fr;gap:8px} @media (min-width:720px){.two{grid-template-columns:1fr 1fr}}
    .status{font-size:12px;opacity:.85}
  </style>
</head>
<body>
  <script>
    // === OPSYEN: letak link logo (public URL). Kalau kosong, gambar disembunyikan.
    const TOP_LOGO_URL = '';     // cth: 'https://.../jata.png'
    const BOTTOM_LOGO_URL = '';  // cth: 'https://.../logo-bar.png'
  </script>

  <!-- Opening Menu -->
  <div id="overlay" class="overlay" aria-modal="true" role="dialog">
    <div class="card pad start">
      <div class="center logo-top mb-3">
        <img id="topLogo" src="" alt="Jata Malaysia" />
      </div>
      <h1 class="title center mb-3">SUSUN MAKANAN DALAM PIRAMID MAKANAN</h1>
      <div class="start-content">
        <p class="center small mb-3">Ikut panduan Piramid Makanan Malaysia. Letak makanan ke dalam kotak berwarna mengikut kumpulan yang betul.</p>
        <div class="small mb-3">
          <div class="mb-2" style="font-weight:800;">Cara main (mudah di telefon):</div>
          <ul style="margin:0 0 0 18px;padding:0;line-height:1.5;">
            <li><b>Tap</b> item di bar bawah untuk pilih.</li>
            <li>Zon yang betul akan <b>bersinar</b> ‚Äî tap zon untuk letak.</li>
            <li><b>Undo</b> untuk undur letak terakhir.</li>
            <li>Desktop masih boleh <b>drag & drop</b>.</li>
          </ul>
        </div>
        <div class="center mt-6">
          <button id="startBtn" class="btn">MULAKAN PERMAINAN</button>
        </div>
        <div class="center logo-bar mt-6">
          <img id="bottomLogo" src="" alt="Logo Bar" />
        </div>
      </div>
    </div>
  </div>

  <!-- End Screen -->
  <div id="overlayEnd" class="overlay-end" aria-modal="true" role="dialog">
    <div class="card pad panel">
      <div class="big">TAHNIAH... ANDA BERJAYA üéâ</div>
      <div class="small" id="endTimeText" style="margin-top:6px"></div>
      <div class="form">
        <label class="small" for="playerName"><b>Nama pemain</b></label>
        <input id="playerName" class="input" placeholder="Contoh: Ali / Siti" />
        <label class="small" for="playerLoc"><b>Lokasi</b> <span class="xs">(cth: Klinik A / PPD / Sekolah)</span></label>
        <input id="playerLoc" class="input" placeholder="Contoh: SMK Seri Maju, Johor" />
        <div class="two">
          <button id="saveBtn" class="btn">SIMPAN</button>
          <button id="playAgainBtn" class="btn secondary">Main Lagi</button>
        </div>
        <div id="saveStatus" class="status"></div>
      </div>
    </div>
  </div>

  <!-- Game UI -->
  <div class="wrap" id="app" style="display:none" aria-hidden="true">
    <div class="grid">
      <div class="card pad">
        <h1 class="title">Susun Makanan üçΩÔ∏è</h1>
        <p class="small">Letak makanan ke kumpulan yang betul mengikut Piramid Makanan Malaysia.</p>
        <div class="row-actions" style="margin:10px 0 8px">
          <div class="small"><b>Skor:</b> <span id="score">0</span></div>
          <div class="small"><b>Salah:</b> <span id="miss">0</span></div>
          <div class="small"><b>‚è±Ô∏è Masa:</b> <span id="timer">00:00</span></div>
          <button id="undoBtn" class="btn">Undo</button>
          <button id="resetBtn" class="btn">Reset</button>
        </div>
        <h3 class="small" style="font-weight:800">Menu (Desktop)</h3>
        <div id="palette-left"></div>
      </div>

      <div class="card pad">
        <h2 class="title">Piramid Makanan (Kotak Berwarna)</h2>
        <div id="pyramid" style="margin-top:8px"></div>
        <div id="summary"></div>
      </div>
    </div>
  </div>

  <!-- Mobile dock palette -->
  <div id="dock" class="dock" style="display:none" aria-hidden="true">
    <div class="dock-row">
      <div class="dock-title">Menu</div>
      <div style="margin-left:auto" class="small">Tap item ‚Üí tap zon</div>
    </div>
    <div id="dock-strip" class="dock-strip"></div>
  </div>

  <script>
    // ===== Data =====
    const CATEGORIES = {
      SAYUR:   { key:"SAYUR",   label:"Sayur-sayuran", hex:"#86efac" },
      BUAH:    { key:"BUAH",    label:"Buah-buahan",   hex:"#bef264" },
      KARBO:   { key:"KARBO",   label:"Makanan Karbohidrat", hex:"#fcd34d" },
      PROTEIN: { key:"PROTEIN", label:"Sumber Protein", hex:"#fca5a5" },
      TENUSU:  { key:"TENUSU",  label:"Susu & Tenusu", hex:"#93c5fd" },
      LMGGS:   { key:"LMGGS",   label:"Gula, Garam, Minyak, Santan, Sos, Kicap", hex:"#f0abfc" },
    };

    // Boleh tukar emoji‚ÜíPNG dengan tambah 'img:' (URL public). Emoji jadi fallback.
    const ALL_ITEMS = [
      { id:"brokoli", name:"Brokoli", emoji:"ü•¶", category:"SAYUR" },
      { id:"bayam",   name:"Bayam",   emoji:"ü•¨", category:"SAYUR" },
      { id:"lobak",   name:"Lobak Merah", emoji:"ü•ï", category:"SAYUR" },
      { id:"timun",   name:"Timun",   emoji:"ü•í", category:"SAYUR" },
      { id:"epal",    name:"Epal",    emoji:"üçé", category:"BUAH" },
      { id:"pisang",  name:"Pisang",  emoji:"üçå", category:"BUAH" },
      { id:"betik",   name:"Betik",   emoji:"üüß", category:"BUAH" },
      { id:"tembikai",name:"Tembikai",emoji:"üçâ", category:"BUAH" },
      { id:"nasi",    name:"Nasi Putih", emoji:"üçö", category:"KARBO" },
      { id:"roti",    name:"Roti",    emoji:"üçû", category:"KARBO" },
      { id:"mee",     name:"Mee Kuning", emoji:"üçú", category:"KARBO" },
      { id:"ubi",     name:"Ubi Kentang", emoji:"ü•î", category:"KARBO" },
      { id:"ikan",    name:"Ikan",    emoji:"üêü", category:"PROTEIN" },
      { id:"ayam",    name:"Ayam",    emoji:"üçó", category:"PROTEIN" },
      { id:"telur",   name:"Telur",   emoji:"ü•ö", category:"PROTEIN" },
      { id:"kacang",  name:"Kacang",  emoji:"ü•ú", category:"PROTEIN" },
      { id:"susu",    name:"Susu",    emoji:"ü•õ", category:"TENUSU" },
      { id:"yogurt",  name:"Yogurt",  emoji:"üß™", category:"TENUSU" },
      { id:"keju",    name:"Keju",    emoji:"üßÄ", category:"TENUSU" },
      { id:"minyak",  name:"Minyak",  emoji:"üõ¢Ô∏è", category:"LMGGS" },
      { id:"gula",    name:"Gula",    emoji:"üßÇ", category:"LMGGS" },
      { id:"garam",   name:"Garam",   emoji:"üßÇ", category:"LMGGS" },
      { id:"kicap",   name:"Kicap",   emoji:"ü•£", category:"LMGGS" },
      { id:"sos",     name:"Sos Tomato", emoji:"üç∂", category:"LMGGS" },
      { id:"santan",  name:"Santan",  emoji:"ü••", category:"LMGGS" },
    ];

    const ZONES = [
      { id:"lvl4", label:CATEGORIES.LMGGS.label,               accepts:["LMGGS"],            row:4 },
      { id:"lvl3", label:"Protein, Susu & Tenusu",             accepts:["PROTEIN","TENUSU"],row:3 },
      { id:"lvl2", label:CATEGORIES.KARBO.label,               accepts:["KARBO"],            row:2 },
      { id:"lvl1", label:"Buah & Sayur-sayuran",               accepts:["SAYUR","BUAH"],     row:1 },
    ];

    const state = {
      items: ALL_ITEMS.map(i => ({ ...i, placedZoneId:null })),
      score: 0, miss: 0, selectedId: null,
      startTime: null, timerInterval: null,
      history: []
    };

    // ===== Logo runtime set =====
    (function setLogos(){
      const t = document.getElementById('topLogo');
      const b = document.getElementById('bottomLogo');
      if (TOP_LOGO_URL) t.src = TOP_LOGO_URL; else t.style.display='none';
      if (BOTTOM_LOGO_URL) b.src = BOTTOM_LOGO_URL; else b.style.display='none';
    })();

    // ===== Icon renderer (emoji atau PNG) =====
    function iconNode(item, extraClass='') {
      if (item.img) {
        const im = document.createElement('img');
        im.src = item.img; im.alt = item.name; im.className = ('sprite ' + extraClass).trim();
        return im;
      }
      const emo = document.createElement('div');
      emo.className = ('emoji ' + extraClass).trim();
      emo.textContent = item.emoji || '‚ùì';
      return emo;
    }

    // ===== Timer =====
    function startTimer(){ state.startTime=Date.now(); updateTimer(); clearInterval(state.timerInterval); state.timerInterval=setInterval(updateTimer,1000); }
    function resetTimer(){ state.startTime=Date.now(); }
    function stopTimer(){ clearInterval(state.timerInterval); state.timerInterval=null; }
    function formatDuration(sec){ const m=String(Math.floor(sec/60)).padStart(2,'0'); const s=String(sec%60).padStart(2,'0'); return m+':'+s; }
    function updateTimer(){ if(!state.startTime)return; const sec=Math.floor((Date.now()-state.startTime)/1000); document.getElementById('timer').textContent=formatDuration(sec); }

    // ===== Helpers =====
    function gradientFor(accepts){ const colors=(accepts||[]).map(k=>CATEGORIES[k]?.hex).filter(Boolean); return colors.length>1 ? `linear-gradient(90deg, ${colors[0]}, ${colors[1]})` : (colors[0]||'#e5e7eb'); }
    function canZonesFor(item){ return ZONES.filter(z=>z.accepts.includes(item.category)); }

    // ===== Renderers =====
    function renderLeftPalette(){
      const el=document.getElementById('palette-left'); if(!el) return; el.innerHTML='';
      state.items.filter(i=>!i.placedZoneId).forEach(item=>{
        const wrap=document.createElement('div'); wrap.className='food'+(state.selectedId===item.id?' held':'');
        wrap.draggable=true; wrap.addEventListener('dragstart',e=>{e.dataTransfer.setData('text/plain',item.id); state.selectedId=item.id; highlightValidZones();});
        wrap.addEventListener('click',()=>{ toggleSelect(item); });
        const box=document.createElement('div'); box.className='box';
        box.appendChild(iconNode(item));
        const nm=document.createElement('div'); nm.className='name'; nm.textContent=item.name;
        box.appendChild(nm); wrap.appendChild(box); el.appendChild(wrap);
      });
    }
    function renderDock(){
      const strip=document.getElementById('dock-strip'); if(!strip) return; strip.innerHTML='';
      state.items.filter(i=>!i.placedZoneId).forEach(item=>{
        const chip=document.createElement('button'); chip.type='button'; chip.className='chip'+(state.selectedId===item.id?' held':'');
        chip.setAttribute('aria-label', item.name);
        chip.addEventListener('click',()=>{ toggleSelect(item); });
        let pressTimer=null;
        chip.addEventListener('touchstart',()=>{ pressTimer=setTimeout(()=>toggleSelect(item),600); },{passive:true});
        chip.addEventListener('touchend',()=>{ clearTimeout(pressTimer); },{passive:true});
        chip.appendChild(iconNode(item));
        const nm=document.createElement('div'); nm.className='name'; nm.textContent=item.name;
        chip.appendChild(nm); strip.appendChild(chip);
      });
    }
    function renderPyramid(){
      const host=document.getElementById('pyramid'); host.innerHTML='';
      const rows=[{id:'lvl4',cls:'w-top'},{id:'lvl3',cls:'w-midA'},{id:'lvl2',cls:'w-midB'},{id:'lvl1',cls:'w-bottom'}];
      for(const r of rows){
        const row=document.createElement('div'); row.className='row';
        const wrap=document.createElement('div'); wrap.className=r.cls;
        const zone=ZONES.find(z=>z.id===r.id);
        const dz=document.createElement('div'); dz.className='drop'; dz.id='zone-'+zone.id; dz.style.background=gradientFor(zone.accepts);
        dz.addEventListener('dragover',e=>e.preventDefault());
        dz.addEventListener('drop',e=>{ e.preventDefault(); const id=e.dataTransfer.getData('text/plain'); const item=state.items.find(i=>i.id===id); if(item) onPlace(item, zone); });
        dz.addEventListener('click',()=>{ if(!state.selectedId) return; const item=state.items.find(i=>i.id===state.selectedId); if(item) onPlace(item, zone); });
        const hdr=document.createElement('div'); hdr.className='hdr';
        hdr.innerHTML=`<div>${zone.label}</div>` + (state.selectedId?`<div class="xs"><b>[Fokus]</b></div>`:'');
        dz.appendChild(hdr);
        const grid=document.createElement('div'); grid.className='grid';
        const placed=state.items.filter(i=>i.placedZoneId===zone.id);
        if(placed.length){
          placed.forEach(i=>{
            const c=document.createElement('div'); c.className='cell';
            c.appendChild(iconNode(i));
            grid.appendChild(c);
          });
        } else {
          const hint=document.createElement('div'); hint.className='hint'; hint.textContent='Tap/seret item untuk letak di sini‚Ä¶';
          grid.appendChild(hint);
        }
        dz.appendChild(grid); wrap.appendChild(dz); row.appendChild(wrap); host.appendChild(row);
      }
    }
    function renderSummary(){
      const host=document.getElementById('summary'); host.innerHTML='';
      ZONES.forEach(z=>{
        const card=document.createElement('div'); card.className='card pad';
        const tt=document.createElement('div'); tt.style.fontWeight='800'; tt.style.fontSize='14px'; tt.style.marginBottom='6px'; tt.textContent=z.label; card.appendChild(tt);
        const wrap=document.createElement('div'); wrap.style.display='flex'; wrap.style.flexWrap='wrap'; wrap.style.gap='8px';
        const group=state.items.filter(i=>i.placedZoneId===z.id);
        if(group.length){
          group.forEach(i=>{
            const pill=document.createElement('span'); pill.style.border='4px solid var(--ink)'; pill.style.borderRadius='12px'; pill.style.padding='4px 6px'; pill.style.display='inline-flex'; pill.style.alignItems='center'; pill.style.gap='6px'; pill.style.boxShadow='4px 4px 0 0 var(--ink)'; pill.style.background='#fff';
            pill.appendChild(iconNode(i));
            const nm=document.createElement('span'); nm.textContent=i.name; nm.style.fontSize='12px'; pill.appendChild(nm);
            wrap.appendChild(pill);
          });
        } else {
          const dash=document.createElement('span'); dash.className='xs'; dash.textContent='‚Äî'; wrap.appendChild(dash);
        }
        card.appendChild(wrap); host.appendChild(card);
      });
    }
    function highlightValidZones(){
      const all=document.querySelectorAll('.drop');
      all.forEach(d=>d.classList.remove('dim','pulse'));
      if(!state.selectedId) return;
      const item=state.items.find(i=>i.id===state.selectedId);
      const allowed=new Set(canZonesFor(item).map(z=>z.id));
      all.forEach(d=>{
        const id=d.id.replace('zone-','');
        if(allowed.has(id)) d.classList.add('pulse'); else d.classList.add('dim');
      });
    }
    function renderAll(){
      document.getElementById('score').textContent=state.score;
      document.getElementById('miss').textContent=state.miss;
      renderLeftPalette(); renderDock(); renderPyramid(); renderSummary(); highlightValidZones();
    }

    function toggleSelect(item){
      if(state.selectedId===item.id) state.selectedId=null; else { state.selectedId=item.id; autoScrollToValid(item); }
      renderAll();
    }
    function autoScrollToValid(item){
      const zones=canZonesFor(item); if(!zones.length) return;
      const el=document.getElementById('zone-'+zones[0].id);
      if(el && 'scrollIntoView' in el) el.scrollIntoView({behavior:'smooth', block:'center'});
    }
    function onPlace(item, zone){
      const ok=zone.accepts.includes(item.category);
      if(ok){
        item.placedZoneId=zone.id; state.history.push({ id:item.id, zone:zone.id });
        state.score+=10; state.selectedId=null;
      } else { state.miss+=1; }
      renderAll();
      const remaining=state.items.filter(i=>!i.placedZoneId).length;
      if(remaining===0) onGameComplete();
    }
    function undo(){
      const last=state.history.pop(); if(!last) return;
      const it=state.items.find(i=>i.id===last.id); if(it) it.placedZoneId=null;
      state.score=Math.max(0, state.score-10); renderAll();
    }
    function resetGame(){
      state.items=ALL_ITEMS.map(i=>({ ...i, placedZoneId:null }));
      state.score=0; state.miss=0; state.selectedId=null; state.history=[];
      renderAll(); resetTimer();
    }

    function onGameComplete(){
      stopTimer();
      const sec=Math.floor((Date.now()-state.startTime)/1000);
      const t=formatDuration(sec);
      const local=new Date().toLocaleString();
      document.getElementById('endTimeText').textContent = "Masa diambil: " + t + " ‚Äî " + local;
      const prevName=localStorage.getItem('rekodNamaTerakhir'); if(prevName) document.getElementById('playerName').value=prevName;
      const prevLoc=localStorage.getItem('rekodLokasiTerakhir'); if(prevLoc) document.getElementById('playerLoc').value=prevLoc;
      document.getElementById('overlayEnd').style.display='flex';
      document.getElementById('saveBtn').onclick = () => saveRecord(sec);
      document.getElementById('playAgainBtn').onclick = () => goToOpeningMenu();
    }

    // === Simpan rekod ke Sheet melalui Apps Script (tiada URL diperlukan)
    function saveRecord(sec){
      const name=(document.getElementById('playerName').value||'Tanpa Nama').trim();
      const location=(document.getElementById('playerLoc').value||'').trim();
      localStorage.setItem('rekodNamaTerakhir', name);
      localStorage.setItem('rekodLokasiTerakhir', location);

      const rec = {
        name, location, seconds: sec, time: formatDuration(sec),
        finishedAtLocal: new Date().toLocaleString(),
        finishedAtISO: new Date().toISOString(),
        userAgent: navigator.userAgent || '',
        version: 'gas-v13'
      };

      const statusEl=document.getElementById('saveStatus');
      statusEl.textContent='Menyimpan...';

      google.script.run
        .withSuccessHandler(()=>{ statusEl.textContent = 'Berjaya simpan ‚úîÔ∏è'; })
        .withFailureHandler(err => { statusEl.textContent = 'Gagal: ' + err.message; })
        .appendRecord(rec);
    }

    function goToOpeningMenu(){
      document.getElementById('overlayEnd').style.display='none';
      const app=document.getElementById('app'); app.style.display='none'; app.setAttribute('aria-hidden','true');
      const dock=document.getElementById('dock'); dock.style.display='none'; dock.setAttribute('aria-hidden','true');
      const ov=document.getElementById('overlay'); ov.style.display='flex';
      resetGame();
    }

    // Wire up
    document.getElementById('startBtn').addEventListener('click', ()=>{
      document.getElementById('overlay').style.display='none';
      const app=document.getElementById('app'); app.style.display='block'; app.removeAttribute('aria-hidden');
      const dock=document.getElementById('dock'); dock.style.display='block'; dock.removeAttribute('aria-hidden');
      renderAll(); startTimer();
    });
    document.getElementById('resetBtn').addEventListener('click', resetGame);
    document.getElementById('undoBtn').addEventListener('click', undo);

    // First render (opening menu visible)
    renderAll();
  </script>
</body>
</html>
